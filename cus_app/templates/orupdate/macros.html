{% macro signoff_cell(field, status, user, time)%}
    <td>
    {% if status == 'Not Required' %}
        {{ status }}
    {% elif status == 'Signed' %}
        {{user}} {{datetime.fromtimestamp(time).strftime('%m/%d/%y')}}
    {% elif status == 'Discard' %}
        NA
    {% elif status == 'Pending' and field != None%}
        {{ field() }}
    {% endif %}
    </td>
{% endmacro%}

{% macro usint_cell(usint_field, approve_field, status, user, time)%}
    {% if status == 'Pending' and usint_field != None and approve_field != None %}
        <td>{{ usint_field() }}<br>{{ approve_field() }}</td>
    {% else %}
        {{ signoff_cell(usint_field, status, user, time) }}
    {% endif %}
{% endmacro%}

{% macro revision_info_cell(revision, _NAME_BY_ID)%}
    <th class='cent' style='background-color:white;'>
        <!-- make link to chkupdata -->
        <u>{{ revision.obsid }}.{{str(revision.revision_number).zfill(3)}}</u><br>
        {{ revision.sequence_number }}<br>
        {{ datetime.fromtimestamp(revision.time).strftime('%m/%d/%y') }}<br>
        {{ _NAME_BY_ID.get(revision.user_id) }}
    </th>
{% endmacro %}

{% macro open_signoff_row(rev, form, sql, _NAME_BY_ID)%}
    <tr>
        {{ revision_info_cell(rev,_NAME_BY_ID) }}
        {{ signoff_cell(form.gen, sql.general_status, _NAME_BY_ID.get(sql.general_signoff_id), sql.general_time) }}
        {{ signoff_cell(form.acis, sql.acis_status, _NAME_BY_ID.get(sql.acis_signoff_id), sql.acis_time) }}
        {{ signoff_cell(form.acis_si, sql.acis_si_status, _NAME_BY_ID.get(sql.acis_si_signoff_id), sql.acis_si_time) }}
        {{ signoff_cell(form.hrc_si, sql.hrc_si_status, _NAME_BY_ID.get(sql.hrc_si_signoff_id), sql.hrc_si_time) }}
        {{ usint_cell(form.usint, form.approve, sql.usint_status, _NAME_BY_ID.get(sql.usint_signoff_id), sql.usint_time) }}
    </tr>
{% endmacro%}

{% macro closed_signoff_row(rev, sql, _NAME_BY_ID)%}
    <tr>
        {{ revision_info_cell(rev,_NAME_BY_ID) }}
        {{ signoff_cell(None, sql.general_status, _NAME_BY_ID.get(sql.general_signoff_id), sql.general_time) }}
        {{ signoff_cell(None, sql.acis_status, _NAME_BY_ID.get(sql.acis_signoff_id), sql.acis_time) }}
        {{ signoff_cell(None, sql.acis_si_status, _NAME_BY_ID.get(sql.acis_si_signoff_id), sql.acis_si_time) }}
        {{ signoff_cell(None, sql.hrc_si_status, _NAME_BY_ID.get(sql.hrc_si_signoff_id), sql.hrc_si_time) }}
        {{ usint_cell(None, None, sql.usint_status, _NAME_BY_ID.get(sql.usint_signoff_id), sql.usint_time) }}
    </tr>
{% endmacro%}

{% macro help_popup_page(html, link_name, font_size=100) %}
<a href="javascript:WindowOpener('{{ html }}', 'orupdate_help', x=1000, y=600)">
    <span style="font-size:{{ font_size }}%;">
   {{ link_name }}
    </span>
</a>
{% endmacro %}